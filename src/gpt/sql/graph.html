<script>
  // ===== Helpers nuevos =====
function getAnalystByExp(exp) {
  const needle = String(exp || '').trim().toLowerCase();
  return baseData.find(r => String(r.analyst_expediente || '').toLowerCase() === needle) || null;
}

function fillAnalystForm(record) {
  const form = document.querySelector('.from-analyst');
  if (!form) return;

  // Limpia primero (opcional)
  form.querySelectorAll('[analyst-data="true"][aria-label]').forEach(inp => { inp.value = ''; });

  if (!record) return;

  form.querySelectorAll('[analyst-data="true"][aria-label]').forEach(inp => {
    const key = inp.getAttribute('aria-label'); // ej. "analyst_name"
    if (!key) return;
    inp.value = record[key] ?? '';
  });
}

function filterTableByExp(exp) {
  const needle = String(exp || '').trim().toLowerCase();
  filteredData = baseData.filter(r =>
    String(r.analyst_expediente || '').toLowerCase().includes(needle)
  );
  currentPage = 1;
  updateView();
}

function openAccordionById(id) {
  const el = document.getElementById(id);
  if (!el) return;
  // Requiere Bootstrap JS cargado (window.bootstrap)
  try {
    const inst = bootstrap.Collapse.getOrCreateInstance(el, { toggle: false });
    inst.show();
  } catch (_) {
    // Si no tienes bootstrap JS, quita 'collapse' para abrir "a lo bruto"
    el.classList.remove('collapse');
    el.classList.add('show');
  }
}

  // Acciones de fila (config/remove)/*********************************/
tbody.addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-action]');
  if (!btn) return;
  const action = btn.dataset.action;
  const expediente = btn.dataset.exp;

  if (action === 'config') {
    const rec = getAnalystByExp(expediente);
    if (!rec) {
      console.warn('Expediente no encontrado:', expediente);
      return;
    }

    // 1) Llenar form
    fillAnalystForm(rec);

    // 2) Abrir acordeÃ³n (ajusta al id real del collapse)
    openAccordionById('analyst-list');

    // 3) Filtrar tabla por expediente (y opcional: reflejar en el buscador)
    filterTableByExp(expediente);
    const searchInput = document.getElementById('analyst-search');
    if (searchInput) searchInput.value = expediente;
  } else if (action === 'remove') {
    console.log('Eliminar', expediente);
  }
});


  /************reset form*///////////
  function resetAnalystForm() {
  document.querySelectorAll('.from-analyst [analyst-data="true"][aria-label]')
    .forEach(inp => inp.value = '');
}

  /********Seleccionar nombre**************/
  document.querySelector('.from-analyst [aria-label="analyst_name"]')?.focus();

